<%
core.forum.data.thread();
var id = request.id;
var t = db.forum.topics.findOne({_id: id});

if ( jxp.pieces && jxp.pieces.header ){ jxp.pieces.header(); }
else { 
%>
<html>
  <head>
    <title>Forum <%= t.name %></title>
    <link rel="stylesheet" type="text/css" href="css/forum.css"/>
  </head>
  <body>
    <h1><a href="./">Forum</a></h1>
    <h1>Available threads</h1>
    <table>
      <tr>
        <td>
          Thread
        </td>
        <td>
          Replies
        </td>
        <td>
          Last post
        </td>
      </tr>
<%}%>
<%
var list = Forum.data.Thread.list(t);
if (list)
    list.forEach(Forum.renderer.thread);
else
    print ("No topics right now!");
%>
<%
if ( jxp.pieces && jxp.pieces.footer ){ jxp.pieces.footer(); }
else {
%>
</table>
<a href="thread_new?top_id=<%= id %>&reply=true">New thread</a>
<a href="./">Back to toplevel</a>
  </body>
</html>
<% } %>
